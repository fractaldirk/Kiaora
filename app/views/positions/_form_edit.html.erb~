<%= form_for(@position) do |f| %>
  <% if @position.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@position.errors.count, "error") %> prohibited this position from being saved:</h2>

      <ul>
      <% @position.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <% if current_user.role == 1 %>
    <div class="field">
      <strong>Status:</strong>
      <%= f.select(:draft, [['Draft', '1'], ['Final', '2']]) %>
    </div>
  <% else %>
    <div class="hidden">
      <strong>Status:</strong>
      <%= f.select(:draft, [['Draft', '1'], ['Final', '2']]) %>
    </div>
  <% end %>

  <div class="hidden">
    <strong>User name:</strong>
    <%= f.text_field :user_name, :value => current_user.user_name %>
  </div>

  <hr />

  <h4>General details</h4>
  <div class="field">
    <strong><em>job title: </em></strong>
    <%= f.text_field :job_title, :class => "text_field" %><br/>
    <strong><em>valid from: </em></strong>
    <%= f.date_select(:valid_from, :order => [:day, :month, :year]) %><br/>
    <strong><em>job grade: </em></strong>
    <%= f.text_field :job_grade, :class => "text_field" %><br/>
    <strong><em>reports to: </em></strong>
    <%= f.text_field :reports_to, :class => "text_field" %><br/>
    <strong><em>line manages: </em></strong>
    <%= f.text_field :line_manages, :class => "text_field" %><br/>
  </div>

  <hr />

  <h4>Main body</h4>
  <div class="field">
    <p><strong>Overall purpose of the job:</strong></p>
    <%= f.text_area :purpose, :class => "text_area" %><br/>
  </div>

  <div class="field">
    <p><strong>Scope:</strong></p>
    <%= f.text_area :scope, :class => "text_area" %><br/>
  </div>

<hr />

  <h2>Responsibilities</h2>
  <h4>Conceptual tasks, Strategy Development and/or Project Development</h4>
  <% if @conceptual.present? %>
    <%= f.fields_for :responsibilities, @conceptual do |builder| %>
      <%= render "responsibility_fields", f: builder %>
    <% end %>
  <% end %>
  <%= link_to_add_conceptual_fields "Add Responsibility", f, :responsibilities %>

  <h4>Implementation</h4>
  <% if @implementation.present? %>
    <%= f.fields_for :responsibilities, @implementation do |builder| %>
    <%= render "responsibility_fields", f: builder %>
    <% end %>
  <% end %>
  <%= link_to_add_implementation_fields "Add Responsibility", f, :responsibilities %>

  <h4>Support / Coaching / Leadership</h4>
  <% if @support.present? %>
    <%= f.fields_for :responsibilities, @support do |builder| %>
      <%= render "responsibility_fields", f: builder %>
    <% end %>
  <% end %>
  <%= link_to_add_support_fields "Add Responsibility", f, :responsibilities %>

  <h4>Compliance / Keeping Framework Conditions</h4>
  <% if @compliance.present? %>
    <%= f.fields_for :responsibilities, @compliance do |builder| %>
      <%= render "responsibility_fields", f: builder %>
    <% end %>
  <% end %>
  <%= link_to_add_compliance_fields "Add Responsibility", f, :responsibilities %>

<hr />
  <h3>Attitude</h3>
  <%= f.fields_for :attitudes do |builder| %>
    <%= render "attitude_fields", f: builder %>
  <% end %>
  <%= link_to_add_fields "Add Attitude", f, :attitudes %>

<hr />
  <h3>Specific Work Environment</h3>
  <%= f.fields_for :conditions do |builder| %>
    <%= render "condition_fields", f: builder %>
  <% end %>
  <%= link_to_add_fields "Add Criterea", f, :conditions %>

<hr />

  <h3>Competency profile</h3>
  <h4>Organisational competencies</h4>
  <%= f.fields_for :organisationals do |builder| %>
    <%= render "organisational_fields_edit", f: builder %>
  <% end %>

  <h4>Technical competencies</h4>
    <%= f.fields_for :functionals do |builder| %>
      <%= render "functional_fields", f: builder %>
    <% end %>
    <%= link_to_add_fields "Add Competency", f, :functionals %>

  <h4>Method related competencies</h4>
  <%= f.fields_for :methodrelations do |builder| %>
    <%= render "methodrelation_fields", f: builder %>
  <% end %>
  <%= link_to_add_fields "Add Competency", f, :methodrelations %>

  <h4>Leadership competencies</h4>
  <%= f.fields_for :leaderships do |builder| %>
    <%= render "leadership_fields", f: builder %>
  <% end %>
  <%= link_to_add_fields "Add Competency", f, :leaderships %>

  <h4>Social/self competencies</h4>
  <%= f.fields_for :socials do |builder| %>
    <%= render "social_fields", f: builder %>
  <% end %>
  <%= link_to_add_fields "Add Competency", f, :socials %>

<hr />

<hr />

  <div class="actions">
    <%= f.submit :class => 'btn btn-success' %>
  </div>

<% end %>
